<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Resumen de Compra y Pago | Kawasaki</title>

    <th:block th:replace="layout :: headLinks"></th:block>
    <link rel="stylesheet" th:href="@{/css/estilos.css}">

    <style>
        /* Paleta Formal y Oscura (CSS se mantiene igual) */
        :root {
            --color-background: #191919;
            --color-surface: #2c2c2c;
            --color-accent: #008000;
            --color-text-primary: #e0e0e0;
            --color-text-secondary: #aaaaaa;
            --color-border: #404040;
        }

        body {
            background-color: var(--color-background);
            color: var(--color-text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.5;
        }

        .summary-container {
            max-width: 750px;
            margin: 80px auto;
            padding: 40px;
            background-color: var(--color-surface);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--color-border);
        }

        .summary-title {
            color: var(--color-accent);
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 40px;
            text-transform: uppercase;
        }

        .summary-total {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--color-text-primary);
            background-color: #383838;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--color-accent);
        }

        .payment-option {
            border: 1px solid var(--color-border);
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .payment-option:hover {
            border-color: var(--color-accent);
            background-color: #3a3a3a;
        }

        .payment-option input[type="radio"] {
            transform: scale(1.1);
            margin-right: 12px;
            accent-color: var(--color-accent);
        }

        .payment-option .text-muted {
            color: var(--color-text-secondary) !important;
        }

        /* Estilos para los contenedores din√°micos */
        .payment-details-box {
            border: 1px dashed var(--color-accent);
            padding: 20px;
            margin-top: 5px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #333;
        }

        .btn-confirm {
            background-color: var(--color-accent);
            color: var(--color-background);
            font-weight: 700;
            border: none;
            padding: 10px 30px;
            transition: background-color 0.2s, color 0.2s;
        }

        .btn-confirm:hover {
            background-color: #00a000;
            color: white;
        }

        .btn-outline-secondary {
            color: var(--color-text-secondary);
            border-color: var(--color-text-secondary);
        }
        .btn-outline-secondary:hover {
            color: var(--color-background);
            background-color: var(--color-text-secondary);
        }
    </style>
</head>
<body data-require-auth="true">

<!-- Navbar com√∫n -->
<th:block th:replace="layout :: navbar"></th:block>

<div class="summary-container">
    <h2 class="summary-title">Resumen de Orden y Pago</h2>

    <div class="d-flex justify-content-between summary-total">
        <span>Total a Pagar:</span>
        <span th:text="'$ ' + ${#numbers.formatDecimal(totalCompra, 1, 'COMMA', 2, 'POINT')}">
            $ 0.00
        </span>
    </div>

    <form th:action="@{/carrito/pagar}" method="post" id="paymentForm">

        <h3>Selecciona tu M√©todo de Pago:</h3>

        <label class="payment-option d-block" for="radioTarjeta">
            <input type="radio" name="metodoPago" value="TARJETA" id="radioTarjeta" required data-target="cardDetails">
            Tarjeta de Cr√©dito/D√©bito üí≥
            <span class="text-muted small d-block mt-2 mb-0">Aceptamos Visa, Mastercard y Amex.</span>
        </label>

        <div id="cardDetails" class="payment-details-box" style="display: none;">
            <h4>Datos de la Tarjeta</h4>
            <div class="mb-3">
                <label for="cardNumber" class="form-label small">N√∫mero de Tarjeta</label>
                <input type="text" class="form-control card-input" id="cardNumber" name="cardNumber" pattern="\d{16}" placeholder="16 d√≠gitos" maxlength="16" required disabled>
            </div>
            <div class="row">
                <div class="col-6 mb-3">
                    <label for="cardExpiry" class="form-label small">Vencimiento (MM/AA)</label>
                    <input type="text" class="form-control card-input" id="cardExpiry" name="cardExpiry" pattern="\d{2}/\d{2}" placeholder="MM/AA" maxlength="5" required disabled>
                </div>
                <div class="col-6 mb-3">
                    <label for="cardCvv" class="form-label small">CVV</label>
                    <input type="text" class="form-control card-input" id="cardCvv" name="cardCvv" pattern="\d{3,4}" placeholder="3 o 4 d√≠gitos" maxlength="4" required disabled>
                </div>
            </div>
        </div>


        <label class="payment-option d-block" for="radioTransferencia">
            <input type="radio" name="metodoPago" value="TRANSFERENCIA" id="radioTransferencia" required data-target="transferDetails">
            Transferencia Bancaria (SPEI) üè¶
            <span class="text-muted small d-block mt-2 mb-0">Recibir√°s los datos de cuenta por email.</span>
        </label>

        <div id="transferDetails" class="payment-details-box" style="display: none;">
            <h4>Instrucciones de Pago</h4>
            <span class="text-muted small d-block mt-2 mb-0">Una vez confirmada la orden, recibir√°s un correo electr√≥nico con los datos de la cuenta bancaria de Kawasaki para realizar la transferencia.</span>
            <p class="small text-warning">Tu pedido ser√° procesado una vez que se confirme la recepci√≥n del pago, lo cual puede tomar hasta 24 horas h√°biles.</p>
        </div>

        <label class="payment-option d-block" for="radioPaypal">
            <input type="radio" name="metodoPago" value="PAYPAL" id="radioPaypal" required data-target="paypalDetails">
            PayPal üÖøÔ∏è
            <span class="text-muted small d-block mt-2 mb-0">Ser√°s redirigido al sitio de PayPal.</span>
        </label>

        <div id="paypalDetails" class="payment-details-box" style="display: none;">
            <h4>Redirecci√≥n a PayPal</h4>
            <p>Al hacer clic en "Confirmar Orden y Pagar", ser√°s redirigido a la plataforma segura de PayPal para completar la transacci√≥n. Vuelve a nuestra tienda una vez finalizado el proceso.</p>
        </div>

        <hr class="text-muted">

        <div class="text-center mt-4">
            <a th:href="@{/carrito/ver}" class="btn btn-outline-secondary me-3">‚Üê Modificar Carrito</a>
            <button type="submit" class="btn btn-confirm px-5">Confirmar Orden y Pagar</button>
        </div>
    </form>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Obtenemos todos los contenedores de detalles de pago
        const paymentDetailBoxes = document.querySelectorAll('.payment-details-box');
        // Obtenemos todos los radios de m√©todo de pago
        const paymentRadios = document.querySelectorAll('input[name="metodoPago"]');
        // Obtenemos solo los inputs que est√°n dentro del panel de la tarjeta (usando la clase 'card-input')
        const cardInputs = document.querySelectorAll('#cardDetails .card-input');


        // Funci√≥n central para controlar la visibilidad y la validaci√≥n
        function toggleDetails(selectedTargetId) {

            // 1. Ocultar todos los paneles de detalles y deshabilitar los campos de tarjeta
            paymentDetailBoxes.forEach(box => {
                box.style.display = 'none';
            });

            cardInputs.forEach(input => {
                input.disabled = true;
                input.required = false;
            });

            // 2. Mostrar el panel seleccionado y habilitar sus campos (si existen)
            const selectedBox = document.getElementById(selectedTargetId);
            if (selectedBox) {
                selectedBox.style.display = 'block';

                // Si el panel seleccionado es la tarjeta, habilitamos sus campos
                if (selectedTargetId === 'cardDetails') {
                    cardInputs.forEach(input => {
                        input.disabled = false;
                        input.required = true;
                    });
                }
            }
        }

        // Evento Listener para los radios
        paymentRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                // El atributo data-target indica qu√© panel mostrar (cardDetails, transferDetails, paypalDetails)
                const targetId = this.getAttribute('data-target');
                if (targetId) {
                    toggleDetails(targetId);
                }
            });
        });

        // Inicializaci√≥n: Asegura que todos los campos est√©n ocultos y deshabilitados al cargar la p√°gina
        toggleDetails(null);

        // Opcional: Si deseas que se muestre el panel de tarjeta por defecto al cargar,
        // descomenta y usa: toggleDetails('cardDetails');
        // y a√±ade 'checked' al radio de tarjeta en el HTML.

    });
</script>

</body>
</html>